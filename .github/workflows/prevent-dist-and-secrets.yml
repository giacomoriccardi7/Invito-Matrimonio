name: Prevent dist and secrets

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Fail if dist directory exists
        run: |
          if [ -d "dist" ]; then
            echo "dist/ should not be committed" >&2
            exit 1
          fi

      - name: Scan for secret patterns
        run: |
          set -e
          patterns='BEGIN PRIVATE KEY|private_key|client_email|GOOGLE_APPLICATION_CREDENTIALS'
          files=$(grep -RIlE "$patterns" --include='*.js' --include='*.ts' --include='*.tsx' --include='*.css' --include='*.html' src public dist index.html || true)
          if [ -n "$files" ]; then
            echo "Potential secrets found in:"
            echo "$files"
            exit 1
          fi